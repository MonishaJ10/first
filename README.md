1.initial_margin_eod

CREATE TABLE initial_margin_eod (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    agreement_name VARCHAR2(255),
    transformed_key VARCHAR2(255)
);

-  agreement_name is from the CSV.
-  transformed_key is created by replacing:
•	_RIMR with 3CR
•	_RIMP with 3CP

2. staralgonew

CREATE TABLE staralgonew (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    crds_party_code VARCHAR2(100),
    post_direction VARCHAR2(50),
    combined_key VARCHAR2(255)
);

- crds_party_code and post_direction are from the CSV.
-  combined_key is formed as:
•	crds_party_code || '3' || post_direction

3. matched_results

CREATE TABLE matched_results (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    agreement_name VARCHAR2(255),
    crds_party_code VARCHAR2(100),
    post_direction VARCHAR2(50),
    match_timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);





4. mismatched_results

CREATE TABLE mismatched_results (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    source_file VARCHAR2(100),
    key_value VARCHAR2(255),
    reason VARCHAR2(255),
    mismatch_timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


1. Transform agreement_name in initial_margin_eod
To replace substrings:

SELECT 
  REPLACE(REPLACE(agreement_name, '_RIMR', '3CR'), '_RIMP', '3CP') AS transformed_key
FROM initial_margin_eod;


2. Create the combined_key in staralgonew
To concatenate crds_party_code, '3', and post_direction:

SELECT 
  crds_party_code || '3' || post_direction AS combined_key
FROM staralgonew;


1. source_file
•	What it holds: The name of the source CSV file where the unmatched record came from.
•	Example Values:
o	'Initial_Margin_EOD_20250307.csv'
o	'STARALGONEW_3428_20250307_1.csv'
________________________________________
2. key_value
•	What it holds: The key used for matching, based on the logic:
o	From initial_margin_eod: transformed agreement_name
	e.g., 'ABC3CRXYZ' (after replacing _RIMR with 3CR)
o	From staralgonew: concatenated value crds_party_code || '3' || post_direction
	e.g., '123453SELL'
This helps trace what value failed to match.
________________________________________
3. reason
•	What it holds: A short explanation of why it was considered a mismatch.
•	Example Values:
o	'No matching key found in STARALGONEW'
o	'No matching key found in Initial_Margin_EOD'
You can customize it further if needed, like:
•	'Post direction mismatch'
•	'Invalid CRDS Party Code' — if you want to validate content too.
________________________________________
Example Row
sql
CopyEdit
| ID | source_file                      | key_value   | reason                            | mismatch_timestamp       |
|----|----------------------------------|-------------|-----------------------------------|--------------------------|
| 1  | Initial_Margin_EOD_20250307.csv | ABC3CPXYZ   | No matching k



DEL THE STAGING TABLE, cd C:\OracleLoadFiles




